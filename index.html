<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sushi Platter Builder</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  :root {
    --bg: #f5f5f7;
    --card-bg: #ffffff;
    --text: #222;
    --muted: #666;
    --accent: #ff7043;
    --accent-alt: #1976d2;
    --danger: #c62828;
    --shadow: 0 2px 10px rgba(0,0,0,0.08);
  }
  body.dark {
    --bg: #101018;
    --card-bg: #1d1f27;
    --text: #f5f5f5;
    --muted: #9fa3b5;
    --accent: #ffa726;
    --accent-alt: #64b5f6;
    --danger: #ef5350;
    --shadow: 0 2px 18px rgba(0,0,0,0.7);
  }

  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: system-ui, sans-serif;
    background: var(--bg);
    color: var(--text);
  }

  header {
    display: flex;
    justify-content: space-between;
    padding: 10px;
    background: #000;
    color: #fff;
  }

  .btn {
    background: var(--accent);
    border: none;
    padding: 7px 14px;
    color: #fff;
    border-radius: 8px;
    cursor: pointer;
  }

  .main {
    display: flex;
    gap: 12px;
    padding: 10px;
  }
  @media(max-width:900px){ .main{flex-direction:column;} }

  .panel {
    background: var(--card-bg);
    padding: 12px;
    border-radius: 12px;
    flex: 1;
    box-shadow: var(--shadow);
  }

  .menu-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(210px,1fr));
    gap: 12px;
  }

  .card {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 10px;
    box-shadow: var(--shadow);
  }

  .qty-btn {
    background: var(--accent-alt);
    border: none;
    color: #fff;
    height: 24px;
    width: 24px;
    border-radius: 4px;
    cursor: pointer;
  }

  .remove-btn{
    background: var(--danger);
    color:#fff;
    border:none;
    padding:3px 6px;
    border-radius:4px;
    cursor:pointer;
  }

  input[type="text"], input[type="number"] {
    width: 100%;
    padding: 7px;
    border-radius: 8px;
    border: 1px solid #ccc;
    background: transparent;
    color: var(--text);
  }

  .chip {
    border:1px solid #aaa;
    padding:4px 10px;
    border-radius:999px;
    cursor:pointer;
    font-size:12px;
  }
  .chip.active{
    background:var(--accent-alt);
    color:#fff;
    border-color:var(--accent-alt);
  }

</style>
</head>
<body>

<header>
  <h1>Sushi Menu Builder</h1>
  <button class="btn" onclick="toggleDarkMode()">Dark Mode</button>
</header>

<div class="main">

  <!-- LEFT PANEL -->
  <div class="panel left-panel">
    <h2>Menu</h2>

    <input type="text" id="searchInput" placeholder="Search..." oninput="renderMenu()">

    <div class="filters" style="margin:8px 0;">
      <span class="chip" data-filter="all" onclick="toggleFilter('all')">All</span>
      <span class="chip" data-filter="roll" onclick="toggleFilter('roll')">Rolls</span>
      <span class="chip" data-filter="nigiri" onclick="toggleFilter('nigiri')">Nigiri</span>
      <span class="chip" data-filter="veg" onclick="toggleFilter('veg')">Veg</span>
      <span class="chip" data-filter="spicy" onclick="toggleFilter('spicy')">Spicy</span>
      <span class="chip" data-filter="raw" onclick="toggleFilter('raw')">Raw</span>
      <span class="chip" data-filter="cooked" onclick="toggleFilter('cooked')">Cooked</span>
    </div>

    <div id="menuGrid" class="menu-grid"></div>
  </div>

  <!-- RIGHT PANEL -->
  <div class="panel right-panel">
    <h2>Cart</h2>
    <div id="cartContainer"></div>

    <h3>Tax %</h3>
    <input type="number" id="taxInput" value="8" onchange="renderCart()">

    <h3>Summary</h3>
    <div id="summaryBox"></div>

    <button class="btn" style="margin-top:10px;" onclick="clearCart()">Clear Cart</button>
  </div>

</div>

<script>
const SHEET_URL =
  "https://opensheet.elk.sh/1zf6BTACk1tLWS9diRqQ3m93aQawfHftiELjByrWjBgE/Sheet1";

let menuItems = [];
let cart = {};
let filters = { all:true, roll:false, nigiri:false, veg:false, spicy:false, raw:false, cooked:false };

fetch(SHEET_URL)
  .then(r=>r.json())
  .then(data=>{
    menuItems = data.map(row=>{
      const image = (row["Sushi Plating"]||"").trim();
      const name  = (row["Name"]||"").trim();

      const price = parseFloat((row["Price"]||"").toString().replace(/[$,]/g,"")) || 0;

      const filling = row["Filling"]||"";
      const sauces  = row["Sauces"]||"";
      const toppings= row["Toppings"]||"";

      const saucesToppings=[sauces,toppings].filter(v=>v).join(", ");

      if(!name) return null;
      const tags = deriveTags(name,filling,saucesToppings);

      return {image,name,price,filling,saucesToppings,tags};
    }).filter(Boolean);

    updateFilterChips();
    renderMenu();
  });


function deriveTags(name,f,s){
  const t=(name+" "+f+" "+s).toLowerCase();
  const tags={roll:false,nigiri:false,veg:false,spicy:false,raw:false,cooked:false};

  if(t.includes("roll"))tags.roll=true;
  if(t.includes("nigiri"))tags.nigiri=true;

  const veg=["cucumber","avocado","vegetable","asparagus"];
  const nonveg=["salmon","eel","shrimp","tuna","crab"];

  if(veg.some(w=>t.includes(w)) && !nonveg.some(w=>t.includes(w))) tags.veg=true;
  if(t.includes("spicy")) tags.spicy=true;
  if(t.includes("raw")) tags.raw=true;
  if(["eel","shrimp","tempura"].some(w=>t.includes(w))) tags.cooked=true;

  return tags;
}

function passesFilters(it){
  if(filters.all) return true;
  for(let f in filters){
    if(f!=="all" && filters[f] && !it.tags[f]) return false;
  }
  return true;
}

function renderMenu(){
  const grid=document.getElementById("menuGrid");
  const q=(document.getElementById("searchInput").value||"").toLowerCase();
  grid.innerHTML="";

  menuItems
    .filter(it=>passesFilters(it))
    .filter(it=>{
      const s=(it.name+it.filling+it.saucesToppings).toLowerCase();
      return s.includes(q);
    })
    .forEach(it=>{
      const icons=[
        it.tags.veg?"ü•ó":"",
        it.tags.spicy?"üå∂Ô∏è":"",
        it.tags.raw?"üêü":"",
        it.tags.cooked?"üç§":""
      ].join(" ");

      grid.innerHTML+=`
        <div class="card">
          <img src="${it.image}" onerror="this.src='https://via.placeholder.com/400x300?text=Sushi';" style="width:100%;height:150px;object-fit:cover;border-radius:10px;">
          <div style="font-weight:600;margin-top:6px;">${it.name} ‚Äî $${it.price.toFixed(2)}</div>
          <div class="meta">${icons}</div>
          <div class="meta"><b>Filling:</b> ${it.filling}</div>
          <div class="meta"><b>Sauces + Toppings:</b> ${it.saucesToppings}</div>
          <div style="display:flex;gap:6px;margin-top:8px;">
            <input type="number" id="qty-${slug(it.name)}" value="1" min="1" style="width:60px;">
            <button class="btn" onclick="addToCart('${it.name}')">Add</button>
          </div>
        </div>
      `;
    });
}

function slug(n){ return n.replace(/\s+/g,"_"); }

function toggleFilter(f){
  if(f==="all"){
    filters={all:true,roll:false,nigiri:false,veg:false,spicy:false,raw:false,cooked:false};
  } else {
    filters.all=false;
    filters[f]=!filters[f];
    if(!Object.keys(filters).some(k=>k!=="all" && filters[k])) filters.all=true;
  }
  updateFilterChips();
  renderMenu();
}

function updateFilterChips(){
  document.querySelectorAll(".chip").forEach(ch=>{
    const f=ch.getAttribute("data-filter");
    ch.classList.toggle("active",filters[f]);
  });
}

function addToCart(name){
  const item=menuItems.find(i=>i.name===name);
  const qty=parseInt(document.getElementById("qty-"+slug(name)).value||1);
  if(!cart[name]) cart[name]={item,qty:0};
  cart[name].qty+=qty;
  renderCart();
}

function changeQty(name,d){
  cart[name].qty+=d;
  if(cart[name].qty<=0) delete cart[name];
  renderCart();
}

function removeFromCart(name){
  delete cart[name];
  renderCart();
}

function pieces(item){
  return item.name.toLowerCase().includes("nigiri")?1:10;
}

function renderCart(){
  const div=document.getElementById("cartContainer");
  const sum=document.getElementById("summaryBox");

  div.innerHTML="";
  let subtotal=0,totalPieces=0;

  Object.keys(cart).forEach(name=>{
    const {item,qty}=cart[name];
    subtotal+=item.price*qty;
    totalPieces+=pieces(item)*qty;

    div.innerHTML+=`
      <div style="border-bottom:1px solid #ccc;padding:8px 0;">
        <div style="display:flex;justify-content:space-between;">
          <span><b>${name}</b></span>
          <span>$${(item.price*qty).toFixed(2)}</span>
        </div>
        <div style="display:flex;justify-content:space-between;font-size:13px;color:var(--muted);">
          <span>
            <button class="qty-btn" onclick="changeQty('${name}',-1)">-</button>
            ${qty}
            <button class="qty-btn" onclick="changeQty('${name}',1)">+</button>
            <button class="remove-btn" onclick="removeFromCart('${name}')">x</button>
          </span>
          <span>${pieces(item)*qty} pcs</span>
        </div>
      </div>
    `;
  });

  if(!Object.keys(cart).length){
    div.innerHTML="<p class='meta'>Cart empty.</p>";
  }

  const taxRate=(parseFloat(document.getElementById("taxInput").value||0)/100);
  const tax=subtotal*taxRate;
  const total=subtotal+tax;

  sum.innerHTML=`
    <div><b>Subtotal:</b> $${subtotal.toFixed(2)}</div>
    <div><b>Tax:</b> $${tax.toFixed(2)}</div>
    <div><b>Total:</b> $${total.toFixed(2)}</div>
    <br>
    <div><b>Total Pieces:</b> ${totalPieces}</div>
  `;
}

function clearCart(){ cart={}; renderCart(); }
function toggleDarkMode(){ document.body.classList.toggle("dark"); }

</script>

</body>
</html>
